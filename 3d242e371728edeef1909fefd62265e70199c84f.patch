From 3d242e371728edeef1909fefd62265e70199c84f Mon Sep 17 00:00:00 2001
From: Janson Kang <temasek71@gmail.com>
Date: Thu, 16 Apr 2015 08:16:11 +0800
Subject: [PATCH] hlte-common: Fix moving apps to external storage

---
 rootdir/etc/fstab.qcom   | 2 +-
 rootdir/etc/init.qcom.rc | 4 ++--
 sepolicy/vold.te         | 1 +
 3 files changed, 4 insertions(+), 3 deletions(-)
 create mode 100644 sepolicy/vold.te

diff --git a/rootdir/etc/fstab.qcom b/rootdir/etc/fstab.qcom
index 0c83ea1..891781a 100644
--- a/rootdir/etc/fstab.qcom
+++ b/rootdir/etc/fstab.qcom
@@ -15,5 +15,5 @@
 /dev/block/platform/msm_sdcc.1/by-name/cache          /cache           f2fs	noatime,nodiratime,background_gc=on,nodiscard,nosuid,nodev               wait,check
 
 # VOLD
-/devices/msm_sdcc.3/mmc_host/mmc2*                     auto             auto    defaults	voldmanaged=sdcard1:auto
+/devices/msm_sdcc.3/mmc_host/mmc2*                     auto             auto    defaults	voldmanaged=sdcard1:auto,noemulatedsd
 /devices/platform/xhci-hcd*                            auto             auto    defaults	voldmanaged=usbdisk:auto
diff --git a/rootdir/etc/init.qcom.rc b/rootdir/etc/init.qcom.rc
index 0e81616..926ab22 100644
--- a/rootdir/etc/init.qcom.rc
+++ b/rootdir/etc/init.qcom.rc
@@ -648,12 +648,12 @@ service sdcard /system/xbin/busybox mount -t sdcardfs -o rw,nosuid,nodev,noatime
     class late_start
     oneshot
 
-service fuse_sdcard1 /system/xbin/busybox mount -t sdcardfs -o rw,nosuid,nodev,noatime,nodiratime,uid=1023,gid=1023,wgid=1015,derive=unified,lower_fs=fat /mnt/media_rw/sdcard1 /storage/sdcard1
+service fuse_sdcard1 /system/xbin/busybox mount -t sdcardfs -o rw,nosuid,nodev,noatime,nodiratime,uid=1023,gid=1023,wgid=1023,derive=unified,lower_fs=fat /mnt/media_rw/sdcard1 /storage/sdcard1
     class late_start
     oneshot
     disabled
 
-service fuse_usbdisk /system/xbin/busybox mount -t sdcardfs -o rw,nosuid,nodev,noatime,nodiratime,uid=1023,gid=1023,wgid=1015,derive=unified,lower_fs=fat /mnt/media_rw/usbdisk /storage/usbdisk
+service fuse_usbdisk /system/xbin/busybox mount -t sdcardfs -o rw,nosuid,nodev,noatime,nodiratime,uid=1023,gid=1023,wgid=1023,derive=unified,lower_fs=fat /mnt/media_rw/usbdisk /storage/usbdisk
     class late_start
     oneshot
     disabled
diff --git a/sepolicy/vold.te b/sepolicy/vold.te
new file mode 100644
index 0000000..7e83901
--- /dev/null
+++ b/sepolicy/vold.te
@@ -0,0 +1 @@
+allow vold vold_tmpfs:file create_file_perms;
